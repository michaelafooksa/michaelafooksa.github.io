<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tech test</title>
  <script type="text/javascript" async="" src="https://static.klaviyo.com/onsite/js/klaviyo.js?company_id=Y8LNjW"></script>
  <script>!function(){if(!window.klaviyo){window._klOnsite=window._klOnsite||[];try{window.klaviyo=new Proxy({},{get:function(n,i){return"push"===i?function(){var n;(n=window._klOnsite).push.apply(n,arguments)}:function(){for(var n=arguments.length,o=new Array(n),w=0;w<n;w++)o[w]=arguments[w];var t="function"==typeof o[o.length-1]?o.pop():void 0,e=new Promise((function(n){window._klOnsite.push([i].concat(o,[function(i){t&&t(i),n(i)}]))}));return e}}})}catch(n){window.klaviyo=window.klaviyo||[],window.klaviyo.push=function(){var n;(n=window._klOnsite).push.apply(n,arguments)}}}}();</script>
</head>
<body>
  <h1>Hello, World!</h1>
  <button id="clickme">Click Here</button>
<!--   <script type="text/javascript">
    document.getElementById("clickme").addEventListener('click',function (){
        klaviyo.push(['track', 'Clicked Button']);
    });
  </script> -->
  
  <form id="klaviyo-custom-form">
        <label for="fname">First Name:</label><br />
        <input type="text" id="fname" name="fname"><br />

        <label for="lname">Last Name:</label><br />
        <input type="text" id="lname" name="lname"> <br />

        <label for="email">Email:</label><br />
        <input type="text" id="email" name="email">
    
       <button data-callback="subscribe">Submit</button>
    </form>
  
  <script type="text/javascript">
        const form = document.getElementById("klaviyo-custom-form");
    
    function subscribe(token) {
            let account = "";

            let firstName = form.fname.value;
            let lastName = form.lname.value;
            let email = form.email.value;
            }
    
    const options = {
                method: 'POST',
                headers: { revision: '2023-02-22', 'content-type': 'application/json' },
                body: JSON.stringify({
                    data: {
                        type: 'event',
                        attributes: {
                            profile: {
                                '$email': email,
                                'First Name': firstName,
                                'Last Name': lastName
                            },
                            metric: {
                                'name': 'Clicked Button';
                            }
                        }
                    }
                })
            };

            fetch(`https://a.klaviyo.com/client/events/?company_id=Y8LNjW`, options)
                .then(response => {
                    if (response.status !== 202) { // Client-side endpoints always return 202 as data is processed async
                        console.log(response.statusTest);
                    }
                })
                .catch(err => console.error(err));
        }
    </script>
  
</body>
</html>
